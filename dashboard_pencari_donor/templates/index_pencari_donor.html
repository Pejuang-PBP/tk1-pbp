{% extends "dashboard/skeleton.html" %} {% load static %} {% block title %}
KonvaSearch - Dashboard {% endblock %} {% block head %}
<link href="{% static 'main.css' %}" rel="stylesheet" />
<link href="{% static 'dashboard/index.css' %}" rel="stylesheet" />
<style>
  body {
    padding: 0rem 1rem;
  }
  .table > :not(:first-child) {
    border-top: none !important;
  }
</style>
{% endblock %} {% block left_content %}
<div class="row">
  <div class="p-5 mb-3 bg-light-blue rounded-10">
    <div class="container-fluid py-3">
      <h1 class="display-6 fw-bold">Halo, {{ user.username }}</h1>
      <p class="fs-5">
        Anda berstatus sebagai
        <span class="text-oxford-blue fw-bold">Pencari Donor</span>
      </p>
      <div id="badge-container" class="d-flex flex-wrap">
        <span class="badge rounded-pill bg-danger px-3 py-2"
          >Belum Terverifikasi</span
        >
        <span class="badge rounded-pill bg-success px-3 py-2"
          >Request Aktif</span
        >
      </div>
    </div>
  </div>
</div>

<div class="row">
  <div class="col-md-12" style="padding: 0 !important">
    <div class="p-5 mb-4 bg-light-blue rounded-10">
      <h4 class="fw-bold text-center">Informasi Request</h4>
      <div class="mb-4">
        <div class="form-group mb-2">
          <label>Nama Pasien</label>
          <input type="text" class="form-control" id="nama_pasien" disabled />
        </div>
        <div class="form-group mb-3">
          <label>NIK</label>
          <input type="text" class="form-control" id="nik" disabled />
        </div>
        <div class="form-group mb-3">
          <label>Nomor Telepon</label>
          <input type="text" class="form-control" id="nomor_telepon" disabled />
        </div>
        <div class="row">
          <div class="col-sm-4">
            <div class="form-group">
              <label>Golongan Darah</label>
              <input
                type="text"
                class="form-control"
                id="golongan_darah"
                disabled
              />
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label>Rhesus</label>
              <input type="text" class="form-control" id="rhesus" disabled />
            </div>
          </div>
          <div class="col-sm-4">
            <div class="form-group">
              <label>Berat Badan</label>
              <input
                type="text"
                class="form-control"
                id="berat_badan"
                disabled
              />
            </div>
          </div>
        </div>
      </div>
      <div class="w-100 d-flex justify-content-center">
        <button class="btn btn-danger me-3">Batalkan</button>
        <button class="btn btn-primary position-relative">
          Calon Donor
          <span
            class="
              position-absolute
              top-0
              start-100
              translate-middle
              badge
              rounded-pill
              bg-danger
            "
          >
            0
            <span class="visually-hidden">unread messages</span>
          </span>
        </button>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block right_content %}
<div class="p-5 mb-4 bg-light-blue rounded-10">
  <h5 class="fw-bold text-center mb-4">Notifications</h5>
  <div id="notifications">
    <div class="bg-light-blue-lite p-4 rounded-10 mb-3">
      <p class="mb-0" style="font-weight: 500">Request anda terpenuhi.</p>
      <p class="mb-0">
        Silahkan cek page request anda untuk mendapatkan kontak donor
      </p>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<!-- AJAX call to fetch and render notifications -->
<script src="{% static 'dashboard/scripts/pencari_donor/notifications.js' %}"></script>
<script>
  const updateRequest = () => {
    fetch("/dashboard/get/request")
      .then((res) => res.json())
      .then((item) => item[0])
      .then((item) => {
        const nama_pasien = document.getElementById("nama_pasien");
        const nik = document.getElementById("nik");
        const nomor_telepon = document.getElementById("nomor_telepon");
        const rhesus = document.getElementById("rhesus");
        const golongan_darah = document.getElementById("golongan_darah");

        nama_pasien.setAttribute("value", item.fields.nama);
        nik.setAttribute("value", item.fields.nomor_induk);
        nomor_telepon.setAttribute("value", item.fields.nomor_hp);
        golongan_darah.setAttribute("value", item.fields.golongan_darah);
        rhesus.setAttribute("value", item.fields.rhesus);
      });
  };

  document.addEventListener("update:request", (e) => {
    updateRequest();
  });

  // Emit event to update request
  document.dispatchEvent(new CustomEvent("update:request"));
</script>
{% endblock %}
